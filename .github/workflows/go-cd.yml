name: CD pipeline

on:
 workflow_run:
   workflows: ["CI Pipeline"]
   branches: [ main ]
   types:
     - completed


jobs:
  deploy:
    needs: [build-and-test]
    runs-on: ubuntu-latest
    steps:
     - uses: actions/download-artifact@v3
      with:
        name: build-artifacts

    - name: Deploy
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.SERVER_IP }}
        username: ec2-user
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        script: |
          sudo systemctl restart listaPro.service
