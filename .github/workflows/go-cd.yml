name: Go CD

on:
  push:
    brances: [ main ]


jobs:
  deploy:
    needs: build
    runs-on: ubuntu-latest
    steps: 
    - uses: actions/checkout@v4

    - name: Install SSH key
      uses: shimataro/ssh-key-action@v2
      with:
        key: ${{ secrets.SSH_PRIVATE_KEY }}
        known_hosts: ${{ secrets.KNOWN_HOSTS }}


    - name: Deploy to EC2
      run: |
        scp -r . ec2-user@{{ secrets.SERVER_IP }}:/home/ec2-user/deploy
	ssh ec2-user@${{ secrets.SERVER_IP }} "cd /home/ec2-user/deploy && go build -o app && s
udo systemctl restart app.service"
